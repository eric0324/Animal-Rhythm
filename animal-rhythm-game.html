<!doctype html>
<html lang="zh-TW">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>節奏挑戰</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                user-select: none;
                -webkit-user-select: none;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                background: #f5f5f5;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                padding: 40px;
                gap: 40px;
            }

            .game-container {
                background: white;
                border-radius: 20px;
                padding: 60px 60px 40px 60px;
                max-width: 1000px;
                width: 100%;
                text-align: center;
            }

            .animal-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
                margin-bottom: 50px;
            }

            .animal-cell {
                aspect-ratio: 1;
                background: #f0f0f0;
                border-radius: 16px;
                display: flex;
                justify-content: center;
                align-items: center;
                transition: all 0.1s ease;
                overflow: hidden;
            }

            .animal-cell img {
                width: 80%;
                height: 80%;
                object-fit: contain;
            }

            .animal-cell.active {
                background: #ffe066;
                transform: scale(1.05);
            }
        </style>
    </head>
    <body>
        <div class="game-container">
            <div class="animal-grid" id="animalGrid"></div>
            <audio id="bgMusic" src="bg.mp3" loop></audio>
        </div>

        <script>
            const animalGrid = document.getElementById("animalGrid");
            const bgMusic = document.getElementById("bgMusic");

            const decks = [1, 2, 3, 4, 6, 7, 9, 10, 11];
            let deckIndex = Math.floor(Math.random() * decks.length);
            let cells = [];
            let interval = null;
            let index = 0;

            function init() {
                animalGrid.innerHTML = "";
                const deck = decks[deckIndex];
                for (let i = 1; i <= 8; i++) {
                    const cell = document.createElement("div");
                    cell.className = "animal-cell";
                    cell.innerHTML = `<img src="images/questions/${deck}/${i}.png" alt="${i}">`;
                    animalGrid.appendChild(cell);
                }
                cells = document.querySelectorAll(".animal-cell");
            }

            function tick() {
                cells.forEach((c) => c.classList.remove("active"));
                cells[index].classList.add("active");
                index++;

                if (index >= 8) {
                    clearInterval(interval);
                    setTimeout(() => {
                        nextRound();
                    }, 350);
                }
            }

            function nextRound() {
                cells.forEach((c) => c.classList.remove("active"));
                deckIndex = (deckIndex + 1) % decks.length;
                init();
                index = 0;

                bgMusic.currentTime = 0;
                bgMusic.play();

                setTimeout(() => {
                    tick();
                    interval = setInterval(tick, 350);
                }, 4000);
            }

            function start() {
                init();
                bgMusic.currentTime = 0;
                bgMusic.play();

                setTimeout(() => {
                    tick();
                    interval = setInterval(tick, 350);
                }, 4000);
            }

            init();

            document.body.addEventListener("click", function handler() {
                document.body.removeEventListener("click", handler);
                bgMusic.currentTime = 0;
                bgMusic.play();

                setTimeout(() => {
                    tick();
                    interval = setInterval(tick, 350);
                }, 4000);
            });
        </script>
    </body>
</html>
